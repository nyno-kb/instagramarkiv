<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8">
  <title>Instagram arkiv Det Kgl. Biblioteks Kønsforskningsservice</title>

  <style>
    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #fafafa;
    }

    header {
      position: static;           
      text-align: center;
      padding: 2rem 1rem 1rem;
      background: #ffe8fa;
    }

    header h1 {
      margin: 0 0 0.5rem;
      font-size: 5rem;
    }

    header p {
      margin: 0;
      color: #6439b8;
      max-width: 40rem;
      margin-inline: auto;
      line-height: 1.4;
    }

    /* 3-COLUMN GRID */
   .gallery {
  display: grid;
  /* auto-fit = as many columns as will fit, min 500px wide */
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
  padding: 0 16px 32px;
  max-width: 1200px;
  margin: 0 auto; /* center the grid on large screens */
}

    /* SINGLE Post*/
    .card {
      background: #fff;
      border-radius: 4px;
      border: 1px solid #ddd;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .card img {
      width: 100%;
      height: auto;     
      display: block;
    }

    .caption {
      padding: 0.75rem 0.9rem 1rem;
      font-size: 0.9rem;
      line-height: 1.4;
      color: #222;
      white-space: pre-wrap;    /* respects the line breaks from JSON */
    }

    .missing {
      width: 100%;
      aspect-ratio: 1 / 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.75rem;
      font-size: 0.8rem;
      color: #777;
      background: #eee;
      text-align: center;
    }
  </style>
</head>

<body>
  <header>
    <h1>Instagram arkiv</h1>
    <p>
      Her kan du finde alle posts der er blevet slået op på instagram af profilen
      Kønsforskning Det Kgl. Bibliotek i perioden xxxxx.
    </p>
  </header>

  <main class="gallery"></main>

   <script>
  function createCarousel(images) {
    const carousel = document.createElement('div');
    carousel.className = 'carousel';

    const imgEl = document.createElement('img');
    imgEl.src = images[0];
    imgEl.alt = '';

    const prevBtn = document.createElement('button');
    prevBtn.className = 'carousel-button prev';
    prevBtn.type = 'button';
    prevBtn.innerText = '‹';

    const nextBtn = document.createElement('button');
    nextBtn.className = 'carousel-button next';
    nextBtn.type = 'button';
    nextBtn.innerText = '›';

    const counter = document.createElement('div');
    counter.className = 'carousel-counter';
    counter.textContent = `1 / ${images.length}`;

    let index = 0;

    function go(delta) {
      index = (index + delta + images.length) % images.length;
      imgEl.src = images[index];
      counter.textContent = `${index + 1} / ${images.length}`;
    }

    prevBtn.addEventListener('click', () => go(-1));
    nextBtn.addEventListener('click', () => go(1));

    carousel.appendChild(imgEl);

    // Only show buttons + counter if there is more than one image
    if (images.length > 1) {
      carousel.appendChild(prevBtn);
      carousel.appendChild(nextBtn);
      carousel.appendChild(counter);
    }

    return carousel;
  }

  function renderPosts(posts) {
    const gallery = document.querySelector('.gallery');
    gallery.innerHTML = '';

    // Optional: sort newest → oldest by creation_timestamp if present
    posts.sort((a, b) => (b.creation_timestamp || 0) - (a.creation_timestamp || 0));

    posts.forEach(item => {
      // Normalize images: prefer item.images, fall back to output_image
      let images = Array.isArray(item.images) ? item.images.slice() : [];
      if (!images.length && item.output_image) {
        images = [item.output_image];
      }

      // Skip posts with no usable images
      if (!images.length) return;

      const card = document.createElement('article');
      card.className = 'card';

      const carousel = createCarousel(images);
      card.appendChild(carousel);

      const captionText = item.caption || '';
      const captionEl = document.createElement('p');
      captionEl.className = 'caption';
      captionEl.textContent = captionText;

      card.appendChild(captionEl);
      gallery.appendChild(card);
    });
  }

  fetch('captions.json')
    .then(r => r.json())
    .then(renderPosts)
    .catch(err => {
      console.error(err);
      document.querySelector('.gallery').innerHTML =
        '<p>Kunne ikke indlæse opslag.</p>';
    });
</script>

</body>
</html>
